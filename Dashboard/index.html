<!DOCTYPE html>

<html lang="en">

<head>
	<meta charset="UTF-8" />
	<title>graph</title>
	<script src="./ext/d3.v3.min.js" charset="utf-8"></script>

	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Vollkorn">
	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Barlow">
	<link rel="stylesheet" href="../Concordance/concordance.css">

	<link rel="stylesheet" type="text/css" href="./dashboard.css">

</head>

<body>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<script type="text/javascript" src="./ext/rainbow.js"></script>

	<script>
	
		$(function() {
			$('#fantastic_jack').rainbow({animate:true,animateInterval:50,colors:['#ff0000','#ff7100','#ffa900','#fff800','#8bff00','#00ff07','#00ff9a','#00ffe8','#00ddff']});
			
		});
	
	</script>

	<div id="dashboard_header" onclick="location.href='https://github.com/jackwong95/TDS3401_DataViz'">
		<span id="dashboard_title" class="dashboard_text"><a>Text with Jack, the <span id="fantastic_jack">Bombastic</span></a></span>
		<span id="dashboard_creator" class="dashboard_text"><a>by choe choon ho and wong tiong kiat</a></span>
	</div>

	<div id="bar_div" class="svg_div">
		<div class="graph_header">
			<span><a class="header_text">Distribution of Sentiment by Words</a></span>
		</div>
		<form id="barchart_query">
			<a class="query_label">Query: </a><br><input id="text_query" type="text" name="text_query" placeholder="search"><br>
			<a class="query_label">Bar count: </a><br><input id="bar_count" type="number" name="bar_count" onchange="barcount_changed()"><br>
			<a class="query_label">Order: </a>
			<br>
			<select id="order_input" onchange="order_changed()">
			  <option value="dsc">Descending</option>
			  <option value="asc">Ascending</option>
			</select>
		</form>
		
		<svg id="svg_barchart"></svg>
	</div>

    <div id="word_clouds" class="svg_div">

		<div class="graph_header">
			<span><a class="header_text">Word Globe</a></span>
		</div>
	    <div id="wc">
	        <ul id ="wc_list">
	        </ul>
	    </div>
	</div>

	<div id="sankey_div" class="svg_div">
		<div class="graph_header">
			<span><a class="header_text">Sankey</a></span>
		</div>
		<svg id="svg_sankey"></svg>
	</div>

	<div id="word_tree" class="svg_div">
		<div class="graph_header">
			<span><a class="header_text">Word Tree</a></span>
		</div>
		<svg id="svg_wordtree"></svg>
	</div>

	<script type="text/javascript" src="./dashboard.js"></script>
	<script type="text/javascript" src="../Concordance/concordance.js"></script>


    <script type="text/javascript" src="../Wordcloud/src/tagcloud.jquery.js"></script>
	<script type="text/javascript" src="../Wordcloud/wordglobe.js"></script>

	<script type="text/javascript">
	
	var text_query = document.getElementById('text_query');
	text_query.onkeyup = function()
	{
	
		selected_data = new Array();
		
		for (var key in barchart_data)
		{
			var temp = barchart_data[key].word;
			
			// current word contains the query
			if (temp.includes(text_query.value) || temp == text_query.value)
			{
				selected_data.push(barchart_data[key]);
			}
		}
		
		create_barchart(selected_data, chart_sz, "#svg_barchart", margin, graph_properties, concordance_integration);
	}
	
	function order_changed()
	{
		var select_elem = document.getElementById('order_input');
		var asc_order = false;
		if (select_elem.options[select_elem.selectedIndex].value=="asc")
		{
			asc_order = true;
		}
		
		graph_properties.order = (asc_order)?"ASC":"DSC";
		create_barchart(selected_data, chart_sz, "#svg_barchart", margin, graph_properties, concordance_integration);
	}
	
	function barcount_changed()
	{
		var barcount_number = parseInt(document.getElementById('bar_count').value);
		graph_properties.show = barcount_number;
		
		create_barchart(selected_data, chart_sz, "#svg_barchart", margin, graph_properties, concordance_integration);
	}
	
    var raw_data = [
        { "sentence": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam volutpat dui in vulputate dapibus. Sed ac lacus finibus lorem lobortis scelerisque. In fringilla mollis lacus eget pellentesque. Pellentesque facilisis euismod sollicitudin. Aenean vehicula tellus ut nisl hendrerit, id venenatis eros tempor. Etiam nec nibh in felis blandit tristique et quis ante. Pellentesque eget justo nisi. Fusce non consequat ex. Pellentesque sed turpis lectus. Suspendisse congue massa sit amet nisi placerat viverra. Integer tempor ex at egestas laoreet. Maecenas sodales semper ligula non convallis. Vivamus rutrum lacus sed purus pulvinar placerat. In interdum dapibus justo, vitae accumsan urna tincidunt quis.", "sentiment": 0},
        { "sentence": "Donec ornare vulputate augue sit amet dignissim. Aenean dignissim urna neque, sed faucibus urna sagittis at. Quisque quis elit leo. Nulla aliquam lorem in venenatis tristique. Nulla et diam molestie, vestibulum massa et, interdum massa. Nam elementum sed eros et pharetra. Mauris gravida ex in vestibulum malesuada. Donec sagittis metus at mattis sodales.", "sentiment": 1},
        { "sentence": "Fusce sagittis arcu eu placerat interdum. Maecenas dolor justo, egestas id justo ac, dictum elementum tortor. Morbi et urna dolor. Quisque nec faucibus arcu, a viverra velit. Phasellus malesuada ante sed dolor interdum euismod. Quisque consequat magna et urna tincidunt, vitae dictum diam fermentum. Morbi rutrum libero et scelerisque pharetra. Pellentesque ut leo et neque rutrum viverra. Phasellus id dui purus. Ut quis finibus arcu. Proin commodo augue nec lacus maximus, ut pulvinar ipsum ultrices.", "sentiment": 1},
        { "sentence": "Nunc nisi quam, faucibus ac arcu ac, porttitor pharetra diam. Pellentesque eu condimentum mi. Cras pulvinar eros non purus sollicitudin vulputate. Pellentesque id nibh metus. Phasellus non tortor in ipsum maximus euismod sed quis ante. Nulla dictum sollicitudin fringilla. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Suspendisse varius pulvinar neque vel tempor. Maecenas gravida ligula metus, id congue felis auctor eu. Phasellus ac aliquam eros. Etiam euismod imperdiet enim vel condimentum. Pellentesque at elit at dolor pretium fringilla. Fusce sit amet aliquet ex, quis pharetra eros. Vestibulum eget dui iaculis, mollis velit vitae, rutrum augue. Pellentesque nec magna erat. Etiam fringilla tempus odio ut commodo.", "sentiment": 1},
        { "sentence": "Vestibulum ultricies imperdiet laoreet. Nam in sagittis nibh. Pellentesque laoreet mi non risus venenatis, sit amet porttitor sapien ornare. Sed eget orci pretium, aliquam sapien a, vulputate ligula. Maecenas pellentesque tortor a lacus scelerisque feugiat eu a lorem. Vestibulum nunc nibh, rutrum ac ultricies non, ultrices quis nulla. Nulla placerat ipsum non sapien ornare tempor a sit amet erat. Pellentesque viverra, leo a dictum consectetur, justo orci varius lectus, quis imperdiet magna mi a lectus. Fusce vitae ornare risus. Morbi vehicula libero eget nibh scelerisque aliquet et vel nisl. Vestibulum suscipit luctus elit, eget venenatis nisi mattis eu. Phasellus id turpis eu orci venenatis congue. Pellentesque tempus suscipit elit ac dapibus.", "sentiment": 0},
        { "sentence": "Quisque eget nibh mollis, interdum nunc ut, molestie turpis. Integer elit leo, mattis id mi at, lobortis facilisis eros. Sed convallis risus ut metus pellentesque sodales. Morbi ultrices eros tellus, sit amet dapibus mi fringilla vitae. Sed sollicitudin, tortor sit amet placerat ullamcorper, nisi diam pharetra augue, eu maximus enim mauris vitae lectus. Etiam dictum mi in massa maximus venenatis. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Sed a lacinia ligula. Cras et sapien orci.", "sentiment": 0},
        { "sentence": "Nullam eget posuere turpis. Aenean bibendum eleifend gravida. In molestie sed nisl in placerat. Pellentesque felis orci, sollicitudin feugiat scelerisque vitae, venenatis ac nibh. Cras mollis eu ligula in aliquet. Ut a enim ac nunc imperdiet bibendum eget vel leo. Donec in mattis arcu. Aliquam vulputate a lacus sit amet malesuada. Nam vel metus hendrerit, fringilla augue et, euismod tellus. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Nullam vel mauris in quam euismod lobortis et ut ex. Fusce egestas placerat accumsan. Duis interdum egestas tortor ut porta. Nullam iaculis, dolor in mattis volutpat, mauris erat sagittis nibh, at tristique diam purus id lacus. In pellentesque placerat tortor, id sodales dolor vulputate sed. Aliquam erat volutpat.", "sentiment": 1},
    ];

	var word_table = [];
	for (var i = 0; i < raw_data.length; i ++) {

		var tokens = raw_data[i].sentence.replace("/\W/g", "").split(" ");

		for (var j = 0; j < tokens.length; j ++) {

			if (word_table[tokens[j]] == null) {
				word_table[tokens[j]] = {};
			}

			if (raw_data[i].sentiment) {
				if (word_table[tokens[j]].positive) word_table[tokens[j]].positive ++;
				else word_table[tokens[j]].positive = 1;
			}
			else {
				if (word_table[tokens[j]].negative) word_table[tokens[j]].negative ++;
				else word_table[tokens[j]].negative = 1;
			}
		}
	}

	var count = 0;
	var barchart_data = [];
	for (var w in word_table) {
		barchart_data[count] = {};
		barchart_data[count].word = w;
		barchart_data[count].positive = (word_table[w].positive) ? word_table[w].positive : 0;
		barchart_data[count].negative = (word_table[w].negative) ? word_table[w].negative : 0;
		count ++;
	}

	document.getElementById("bar_count").onkeyup = function() {
		var spinner = document.getElementById("bar_count");
		if (spinner.value < spinner.min) {
			spinner.value = spinner.min;
		}
		else if (spinner.value > spinner.max) {
			spinner.value = spinner.max;
		}
	}

	function concordance_integration(d) {
		concordance(
			d, // word.
			raw_data, // data.
			function(d) { // data.sentence.
				return d.sentence;
			},
			function(d) { // data.sentiment.
				if (d.sentiment) {
					return "#11AA00";
				}
				else {
					return "#C70039";
				}
			},
			15 // page size.
		);
	}

	// clone data currently selected
	var selected_data = new Array();
	// clone 
	Object.keys(barchart_data).forEach(function(key)
	{
    	selected_data.push(barchart_data[key]);
	});
	
	var colors = ["#11AA00", "#C70039"];
	var chart_sz = {height: 250, width:1320};
	var margin = {top:20, bottom:20, left:20, right:90};
	var graph_properties = {colors:["#11AA00", "#C70039"], show:20, order:"DSC", query:""}

	document.getElementById("bar_count").min = 1;
	document.getElementById("bar_count").max = barchart_data.length - 1;
	document.getElementById("bar_count").value = (barchart_data.length - 1 > 20) ? 20 : barchart_data.length - 1;
	
	// ASC for ascending
	// DSC for descending
	create_barchart(selected_data, chart_sz, "#svg_barchart", margin, graph_properties, concordance_integration);

	// word globe
	// [0:{"val":count, ...], 1:["val":count, ...}]
    var globe_data = new Array();
    for (var key in raw_data)
    {
        var tokens = raw_data[key].sentence.replace("/\W/g", "").split(" ");

        for (var tok_key in tokens)
        {
            var token = tokens[tok_key];
            if (globe_data[token] == null)
                globe_data[token] = 0;

            globe_data[token] ++;
        }
    }

    // https://stackoverflow.com/questions/5199901/how-to-sort-an-associative-array-by-its-values-in-javascript
    function toTrueSortedArray(data)
    {
        var temp = [];

        for (var tok in data)
        {
            temp.push([tok, data[tok]]);
        }

        temp.sort(function(a, b)
        {
            return b[1] - a[1];
        });

        for (var i = 0; i < temp.length; i++)
        {
            var key = temp[i][0];
            var value = temp[i][1];
        }
        return temp;
    }

    // convert data to true array
    globe_data = toTrueSortedArray(globe_data);

    function onTagSelected (d)
    {
        console.log(d.path[0].innerHTML);
    }

            var globe_settings = {
                height: 300,
                width: 300,
                radius: 100,
                speed: 3,
                slower: 0.9,
                timer: 5,
                fontMultiplier: 15,
                hoverStyle: {
                    border: 'none',
                    color: '#0b2e6f'
                },
                mouseOutStyle: {
                    border: '',
                    color: ''
                }
            };

    // show only top 100 most frequent word
    var globe_options = {"show":150, "color":"#aaa", "onclick": onTagSelected, "globe_settings":globe_settings, "div_id":"#wc", "list_id":"wc_list"};
    create_wordglobe(globe_data, globe_options);

	</script>
	
</body>
</html>